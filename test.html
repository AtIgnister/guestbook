<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // Create a class for the element
        class Guestbook extends HTMLElement {
            static observedAttributes = ["data-id"];

            constructor() {
                // Always call super first in constructor
                super();
            }

            attributeChangedCallback(name, oldValue, newValue) {
                if (name === "data-id" && newValue) {
                    this.fetchGuestbook(this.getUrl(newValue));
                }
            }

            getUrl(id) {
                return `http://127.0.0.1:8001/guestbooks/${id}/export/json/raw`;
            }

            async fetchGuestbook(url) {
                this.innerHTML = '';
                const id = this.getAttribute("data-id");
                try {
                    console.log(url)
                    const response = await fetch(url);
                    const data = await response.json();

                    console.log("Fetched data:", data);

                    const comments = data.guestbooks[id].entries;
                    console.log(comments);
                    comments.forEach(comment => {
                        this.innerHTML += `
                        <div class='k-comment'>
                            <p class='k-name'>${comment.name}</p>
                            <p class='c-comment'>${comment.comment}</p>
                        </div>
                        `;
                    });
                } catch (error) {
                    console.error("Failed to fetch guestbook:", error);
                }
            }
        }

        customElements.define("x-guestbook", Guestbook);
    </script>
    <x-guestbook data-id="7ddeb8e7-c845-4e81-9410-c129c4f17aa7"></x-guestbook>
</body>
</html>